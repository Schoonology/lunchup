#!/usr/bin/env node
var fs = require('fs')
var path = require('path')
var csv = require('csv')
var minimist = require('minimist')
var LunchUpStream = require('../lib/stream')
var argv = minimist(process.argv.slice(2))
var groupSize = argv._[0]
var inputCsv = argv._[1]
var inputStream = process.stdin

if (inputCsv) {
  inputStream = fs.createReadStream(path.resolve(process.cwd(), inputCsv))
}

inputStream
  .pipe(csv.parse({
    comment: '#',
    skip_empty_lines: true,
    trim: true
  }))
  .pipe(new LunchUpStream({ groupSize: groupSize }))
  .pipe(csv.stringify())
  .pipe(process.stdout)
